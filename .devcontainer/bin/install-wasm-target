#!/bin/bash -i

# Adapted from the docs: https://rustwasm.github.io/docs/wasm-pack/prerequisites/non-rustup-setups.html

export RUST_SYSROOT=$(rustc --print sysroot)
export RUST_VERSION=$(rustc --version | awk '{print $2}')
export RUST_WASM_TARGET_FILE_NAME=rust-std-$RUST_VERSION-wasm32-unknown-unknown

wget -v https://static.rust-lang.org/dist/$RUST_WASM_TARGET_FILE_NAME.tar.gz

tar -vxzf $RUST_WASM_TARGET_FILE_NAME.tar.gz

mv $RUST_WASM_TARGET_FILE_NAME/rust-std-wasm32-unknown-unknown/lib/rustlib/wasm32-unknown-unknown $RUST_SYSROOT/lib/rustlib/

rm $RUST_WASM_TARGET_FILE_NAME.tar.gz
rm -r $RUST_WASM_TARGET_FILE_NAME
